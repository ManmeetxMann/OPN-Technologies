name: Deploy Registry

on:
  push: # Needs to be pull_request
    paths:
      - "packages/common/**"
      - "packages/registry/**"
      - ".github/workflows/ci_registry.yml"
    branches: 
      - development
    tags:
      - infra-dev-registry-*
      - preprod-registry-*

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
        
    - uses: ./.github/actions/deploy-gae
      with:
        service_name: "registry"
      name: Build & Deploy to GAE
      env:
          dev_service_account: ${{ secrets.DEV_GCP_CLOUDBUILD_SA_KEY }}
          infra_dev_service_account: ${{ secrets.INFRA_DEV_GCP_CLOUDBUILD_SA_KEY }}
          preprod_service_account: ${{ secrets.PREPROD_GCP_SERVICE_ACCOUNT }}
          prod_service_account: ${{ secrets.PROD_GCP_SERVICE_ACCOUNT }}